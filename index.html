<!doctype html><html lang='pt-BR'><head><meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'><title>PosologiaCerta • beta 2.2</title><link rel='manifest' href='manifest.json'><style>:root{--bg:#0b1220;--panel:#0f1a2b;--card:#0e1630;--txt:#e6edf3;--acc:#38bdf8;--brand:#22c55e;--radius:16px}body{margin:0;font-family:system-ui,Segoe UI,Roboto;background:#0b1220;color:#e6edf3}.wrap{max-width:1100px;margin:0 auto;padding:20px 14px 80px}.panel{border:1px solid #23324b;border-radius:16px}.search{display:flex;gap:8px;padding:12px;border-bottom:1px solid #23324b}.btn{background:linear-gradient(145deg,var(--acc),#22c55e);border:0;color:#001b0e;padding:10px 12px;border-radius:10px}.chip{padding:8px 12px;border-radius:999px;border:1px solid #23324b;margin:6px}.chip.active{background:linear-gradient(145deg,#0ea5e9,#22c55e);color:#001b0e;border:0;font-weight:800}.grid{display:grid;grid-template-columns:1.2fr .8fr;gap:14px;margin-top:14px}.card{border:1px solid #23324b;border-radius:16px;padding:12px}.notice{border:1px dashed #2a3b55;border-radius:12px;padding:10px 12px;color:#a8bfd8;background:#0c1730}</style></head><body><div class='wrap'><header style='display:flex;justify-content:space-between;align-items:center;gap:12px'><h1>PosologiaCerta <span style='border:1px solid #2a3b55;border-radius:999px;padding:2px 8px;color:#a8bfd8'>beta 2.2</span></h1><div id='bundleInfo' style='border:1px solid #2a3b55;border-radius:999px;padding:2px 8px;color:#a8bfd8'>Bundle: —</div></header><section class='panel'><div class='search'><input id='q' placeholder='Busque por medicamento / patologia / protocolo' style='flex:1;background:#0c1730;color:#e6edf3;border:1px solid #23324b;border-radius:12px;padding:10px 12px'><button id='btn-search' class='btn'>Buscar</button><button id='btn-clear' class='btn' style='background:#0c1730;color:#e6edf3;border:1px solid #23324b'>Limpar</button></div><div style='padding:8px 12px'><span class='chip active' data-mode='adulto'>Adulto</span><span class='chip' data-mode='pediatria'>Pediatria</span><span class='chip' data-mode='gestante'>Gestante</span></div></section><div class='grid'><section id='results' class='card'><div class='notice'>Digite algo acima para ver resultados. Clique em “Aplicar na calculadora” para preencher automaticamente.</div></section><aside class='card'><h3>Calculadoras</h3><div class='notice' style='margin-bottom:8px'><b>Peso por idade (estimativa):</b> preencha idade e clique Estimar.</div><div><input id='idade-anos' type='number' placeholder='Anos' style='width:100px;background:#0c1730;color:#e6edf3;border:1px solid #23324b;border-radius:12px;padding:10px 12px'> <input id='idade-meses' type='number' placeholder='Meses' style='width:100px;background:#0c1730;color:#e6edf3;border:1px solid #23324b;border-radius:12px;padding:10px 12px'> <button id='btn-estimar' class='btn'>Estimar</button></div><div style='margin-top:8px'><input id='peso' type='number' step='0.1' placeholder='Peso (kg)' style='width:120px;background:#0c1730;color:#e6edf3;border:1px solid #23324b;border-radius:12px;padding:10px 12px'> <input id='dose-mgkg' type='number' step='0.1' placeholder='mg/kg' style='width:120px;background:#0c1730;color:#e6edf3;border:1px solid #23324b;border-radius:12px;padding:10px 12px'> <input id='freq' type='number' step='1' placeholder='x/dia' style='width:100px;background:#0c1730;color:#e6edf3;border:1px solid #23324b;border-radius:12px;padding:10px 12px'></div><div style='margin-top:8px'><select id='forma' style='background:#0c1730;color:#e6edf3;border:1px solid #23324b;border-radius:12px;padding:10px 12px'><option value='mL'>mL</option><option value='cp'>comprimidos</option><option value='gota'>gotas</option></select> <input id='concentracao' type='number' step='0.1' placeholder='Concentração (mg/mL ou mg/cp)' style='width:260px;background:#0c1730;color:#e6edf3;border:1px solid #23324b;border-radius:12px;padding:10px 12px'> <button id='btn-calc' class='btn'>Calcular</button> <button id='btn-copy' class='btn' style='background:#0c1730;color:#e6edf3;border:1px solid #23324b'>Copiar</button></div><pre id='calc-out' style='white-space:pre-wrap;font-family:ui-monospace,Consolas,Menlo,monospace;color:#cbd5e1;margin-top:8px'></pre></aside></div><footer style='margin-top:16px;color:#9bb0c9;font-size:12px'>Conteúdo para apoio rápido. Ajustar à clínica, função renal/hepática e interações.</footer></div><script>const CANDIDATES=['posologiacerta-bundle-v0.10-beta2-BR.json','posologiacerta-bundle-v0.9-beta-BR (1).json','posologiacerta-bundle-v0.9-beta-BR.json'];let DB=[];const STATE={modo:'adulto',query:''};function byId(i){return document.getElementById(i)}function el(t,p={},c=[]){const e=document.createElement(t);Object.assign(e,p);if(p.className)e.setAttribute('class',p.className);(c||[]).forEach(x=>e.appendChild(typeof x==='string'?document.createTextNode(x):x));return e}async function tryFetch(u){const r=await fetch(u+'?t='+Date.now(),{cache:'no-store'});if(!r.ok)throw new Error(r.status);return await r.json()}async function autoload(){let L=null,meta=null,name=null;for(const f of CANDIDATES){try{const j=await tryFetch(f);L=Array.isArray(j)?j:(j.medicamentos||[]);meta=j.meta||null;name=f;break}catch(e){}}if(!L){byId('results').innerHTML='<div class="notice">Não foi possível carregar a base. Confira o nome do JSON.</div>';return}DB=L;byId('bundleInfo').textContent='Bundle: '+name+(meta&&meta.versao?(' · '+meta.versao):'')+' • '+DB.length+' fármacos';renderResults(search(STATE.query,true))}function search(q,s){q=(q||'').trim().toLowerCase();STATE.query=q;const list=DB.filter(x=>(x.nome||'').toLowerCase().includes(q)||(x.principioAtivo||'').toLowerCase().includes(q)||(x.indicacoes||[]).some(d=>(d||'').toLowerCase().includes(q)));if(!s)renderResults(list);return list}function renderResults(list){const root=byId('results');root.innerHTML='';if(!list.length){root.appendChild(el('div',{className:'notice',innerHTML:'Sem resultados.'}));return}list.forEach(item=>{const faixa=(item.faixas||{})[STATE.modo]||{};const head=el('div',{className:'title',innerText:item.nome+' • '+STATE.modo});const sub=el('div',{className:'muted',innerText:(item.principioAtivo||'')});const body=el('div',{innerHTML:`<div><b>Indicações:</b> ${(item.indicacoes||[]).join(', ')||'-'}</div><div><b>Dose:</b> ${faixa.dose||faixa.nota||'-'}</div>${faixa.duracao?`<div><b>Duração:</b> ${faixa.duracao}</div>:''}${faixa.max?`<div><b>Máximo:</b> ${faixa.max}</div>:''}`});const btnAuto=el('button',{className:'btn',innerText:'Aplicar na calculadora',onclick:()=>autoApplyPedi(item)});const row=el('div',{className:'result'},[el('div',{},[head,sub,body]),el('div',{className:'actions'},[btnAuto])]);root.appendChild(row)})}function parsePediDose(s){if(!s)return null;const t=(s||'').toLowerCase().replace(',','.').replace(/\s+/g,' ');let a=null,b=null;let m=t.match(/([0-9]+(?:\.[0-9]+)?)\s*(?:–|-|a)\s*([0-9]+(?:\.[0-9]+)?)\s*mg\s*\/\s*kg/);if(m){a=parseFloat(m[1]);b=parseFloat(m[2])}if(a===null){m=t.match(/([0-9]+(?:\.[0-9]+)?)\s*mg\s*\/\s*kg/);if(m){a=parseFloat(m[1]);b=a}}let f=null;if((m=t.match(/(\d+)\s*x\s*\/\s*dia/)))f=parseInt(m[1],10);else if((m=t.match(/cada\s*(\d+)\s*h/)))f=Math.round(24/parseInt(m[1],10));else if((m=t.match(/(\d+)\s*[–\/-]\s*(\d+)\s*h/))){const h=(parseInt(m[1],10)+parseInt(m[2],10))/2;f=Math.round(24/h)}return (a||b||f)?{mgkg_min:a,mgkg_max:b,freq:f}:null}function autoApplyPedi(item){const faixa=((item.faixas||{}).pediatria||{});const info=parsePediDose(faixa.dose||faixa.nota||'');if(!info){alert('Não foi possível extrair mg/kg desta posologia. Preencha manualmente.');return}const mgkg=info.mgkg_max||info.mgkg_min||'';const freq=info.freq||'';byId('dose-mgkg').value=mgkg||'';byId('freq').value=freq||'';if(!byId('peso').value){const p=estimarPeso();if(p)byId('peso').value=p.toFixed(1)}byId('concentracao').focus()}function estimarPeso(){const anos=parseInt(byId('idade-anos').value||'0',10);const meses=parseInt(byId('idade-meses').value||'0',10);const total=anos*12+meses;let w=null;if(total<=12)w=(total/2)+4;else if(anos>=1&&anos<=5)w=2*anos+8;else if(anos>=6&&anos<=12)w=3*anos+7;else w=null;return w}byId('btn-estimar').addEventListener('click',()=>{const p=estimarPeso();if(p){byId('peso').value=p.toFixed(1)}else{alert('Para >12 anos, use peso real.')}});function calcular(){const peso=parseFloat(byId('peso').value);const mgkg=parseFloat(byId('dose-mgkg').value);const freq=parseFloat(byId('freq').value||1);const conc=parseFloat(byId('concentracao').value);const forma=byId('forma').value;if(!(peso>0&&mgkg>0)){byId('calc-out').textContent='Informe peso e mg/kg válidos.';return}const mg=peso*mgkg;let txt=`Dose: ${mg.toFixed(0)} mg por tomada (${freq}x/dia)`;if(conc>0){if(forma==='mL')txt+=`\n≈ ${(mg/conc).toFixed(2)} mL por tomada`;else if(forma==='cp')txt+=`\n≈ ${(mg/conc).toFixed(2)} comprimidos por tomada`;else if(forma==='gota')txt+=`\n≈ ${((mg/conc)/0.05).toFixed(0)} gotas por tomada`}else{txt+='\n(informe concentração para converter)'}byId('calc-out').textContent=txt;return txt}byId('btn-calc').addEventListener('click',()=>calcular());byId('btn-copy').addEventListener('click',()=>{const t=calcular();if(t)navigator.clipboard?.writeText(t)});document.querySelectorAll('.chip[data-mode]').forEach(ch=>{ch.addEventListener('click',()=>{document.querySelectorAll('.chip[data-mode]').forEach(c=>c.classList.remove('active'));ch.classList.add('active');STATE.modo=ch.dataset.mode;renderResults(search(STATE.query,true))})});byId('btn-search').addEventListener('click',()=>renderResults(search(byId('q').value)));byId('btn-clear').addEventListener('click',()=>{byId('q').value='';renderResults(search('',true))});if('serviceWorker'in navigator){navigator.serviceWorker.register('./sw.js?v=pc-v3').catch(()=>{})}autoload();</script></body></html>